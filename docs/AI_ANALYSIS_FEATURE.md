# AI Dashboard Analysis Feature - éœ€æ±‚æ–‡ä»¶

## åŠŸèƒ½æ¦‚è¿°

ä½¿ç”¨ Gemini AI åˆ†æå„€è¡¨æ¿æˆªåœ–ï¼Œæä¾›å°ˆæ¥­çš„è¡ŒéŠ·ç­–ç•¥æ´å¯Ÿèˆ‡åŸ·è¡Œå»ºè­°ã€‚æ­¤åŠŸèƒ½åƒ…é™ç®¡ç†å“¡ä½¿ç”¨ã€‚

---

## ä½¿ç”¨è€…æ•…äº‹

> ä½œç‚ºè¡ŒéŠ·ä¸»ç®¡ï¼Œæˆ‘å¸Œæœ›èƒ½å¤ ä¸€éµç²å¾— AI å°å„€è¡¨æ¿æ•¸æ“šçš„å°ˆæ¥­åˆ†æï¼ŒåŒ…å«ç¾æ³è¨ºæ–·ã€æ ¸å¿ƒæ´å¯Ÿã€æœ¬é€±åŸ·è¡Œæ¸…å–®å’Œè‡ªå‹•åŒ–å»ºè­°ï¼Œä»¥ä¾¿å¿«é€Ÿå„ªåŒ–è¡ŒéŠ·ç­–ç•¥ã€‚

---

## åŠŸèƒ½è¦æ ¼

### è§¸ç™¼æ–¹å¼
- **æµ®å‹•æŒ‰éˆ• (FAB)** - ä½æ–¼ç•«é¢å³ä¸‹è§’çš„æ¼¸å±¤åœ“å½¢æŒ‰éˆ•
- **åœ–ç¤º**ï¼šä½¿ç”¨ `Sparkles` iconï¼ˆLucideï¼‰
- **æ¨£å¼**ï¼šç´«è‰²åˆ°é’è‰²æ¼¸å±¤ã€ç™¼å…‰æ•ˆæœã€hover å‹•ç•«
- **æ¬Šé™**ï¼šåƒ…ç®¡ç†å“¡å¯è¦‹

### åŸ·è¡Œæµç¨‹

```
1. ç®¡ç†å“¡é»æ“Šå³ä¸‹è§’ AI æŒ‰éˆ•
2. é¡¯ç¤º Loading ç‹€æ…‹ï¼ˆå‹•æ…‹é€²åº¦æç¤ºï¼‰
3. ç³»çµ±æˆªå–ç•¶å‰å„€è¡¨æ¿ç•«é¢
4. å°‡æˆªåœ–å‚³é€è‡³å¾Œç«¯ API
5. å¾Œç«¯å‘¼å« Gemini AI é€²è¡Œåˆ†æ
6. è¿”å›åˆ†æçµæœ
7. ä»¥ Modal è¦–çª—é¡¯ç¤ºå°ˆæ¥­æ ¼å¼åŒ–å ±å‘Š
```

### è¼¸å‡ºå…§å®¹çµæ§‹

ä¾æ“šã€Œå¯¦æˆ°æ´¾è¡ŒéŠ·ç­–ç•¥é¡§å•ã€æ¡†æ¶ï¼š

| å€å¡Š | Emoji | èªªæ˜ |
|------|-------|------|
| ç¾æ³è¨ºæ–· | 1ï¸âƒ£ | è­˜åˆ¥è¡¨ç¾ç•°å¸¸çš„ 3 å¤§å•é¡Œï¼ˆé™„æ­£å¸¸åƒè€ƒå€¼ï¼‰ |
| æ ¸å¿ƒæ´å¯Ÿèˆ‡ç†ç”± | 2ï¸âƒ£ | åˆ†æè³‡æ–™äº¤å‰æ¯”å°å¾Œçš„æ ¹å› ï¼ˆ3 é»ï¼‰ |
| æœ¬é€±åŸ·è¡Œæ¸…å–® | 3ï¸âƒ£ | å¯å‹¾é¸çš„å…·é«”è¡Œå‹•é …ç›®ï¼ˆ5-7 é …ï¼‰ |
| è‡ªå‹•åŒ–å»ºè­° | 4ï¸âƒ£ | è‹¥æ¥å…¥è¡ŒéŠ·è‡ªå‹•åŒ–å·¥å…·çš„å„ªå…ˆåŸ·è¡Œäº‹é …ï¼ˆ2-3 é …ï¼‰ |

#### å­å€å¡Šé¡å‹
- âœ… è¡¨ç¾è‰¯å¥½ - ç¶ è‰²èƒŒæ™¯
- âš ï¸ éœ€è¦é—œæ³¨ - æ©˜è‰²èƒŒæ™¯
- ğŸš¨ åš´é‡å•é¡Œ - ç´…è‰²èƒŒæ™¯

---

## AI è¨­å®šç®¡ç†

ç®¡ç†å“¡å¯é€é Settings > AI Analysis æ¨™ç±¤é é€²è¡Œè¨­å®šï¼š

### å¯é…ç½®é …ç›®

| é …ç›® | èªªæ˜ |
|------|------|
| AI åŠŸèƒ½é–‹é—œ | å•Ÿç”¨æˆ–åœç”¨ AI åˆ†æåŠŸèƒ½ |
| AI æ¨¡å‹é¸æ“‡ | Gemini 2.0 Flash / 1.5 Flash / 1.5 Pro |
| ç³»çµ±æç¤ºè© | å®šç¾© AI çš„è§’è‰²å’Œåˆ†æé¢¨æ ¼ |
| è¼¸å‡ºæ ¼å¼ | å®šç¾©åˆ†æå ±å‘Šçš„çµæ§‹å’Œå…§å®¹ |

### é è¨­è¨­å®š
- é è¨­æ¨¡å‹ï¼š`models/gemini-2.0-flash`
- é è¨­è§’è‰²ï¼šå¯¦æˆ°æ´¾è¡ŒéŠ·ç­–ç•¥é¡§å•
- é è¨­è¼¸å‡ºï¼šå››å€å¡Šçµæ§‹åŒ–å ±å‘Š

---

## æŠ€è¡“è¦æ ¼

### å‰ç«¯

| é …ç›® | èªªæ˜ |
|------|------|
| æˆªåœ–å·¥å…· | `html2canvas` |
| åœ–ç‰‡æ ¼å¼ | JPEGï¼ˆå“è³ª 0.8ï¼‰ |
| åœ–ç‰‡å‚³è¼¸ | Base64 ç·¨ç¢¼ |
| æŒ‰éˆ•çµ„ä»¶ | `AIAnalysisButton.jsx` (FAB) |
| çµæœé¡¯ç¤º | `AIAnalysisModal.jsx` (å°ˆæ¥­ Markdown æ¸²æŸ“) |
| è¨­å®šç®¡ç† | `AISettingsManager.jsx` |

### å¾Œç«¯

| é …ç›® | èªªæ˜ |
|------|------|
| API Endpoints | `/api/ai/status`, `/api/ai/analyze-dashboard`, `/api/ai/settings` |
| AI æœå‹™ | Google Gemini API |
| è¨­å®šå„²å­˜ | SQLite è³‡æ–™åº« |
| Max Output | 8192 tokens |

### API Endpoints

#### GET /api/ai/status
æª¢æŸ¥ AI æœå‹™ç‹€æ…‹

**Response:**
```json
{
  "status": "success",
  "ai_enabled": true,
  "model": "models/gemini-2.0-flash"
}
```

#### POST /api/ai/analyze-dashboard
åŸ·è¡Œ AI åˆ†æï¼ˆéœ€ç®¡ç†å“¡æ¬Šé™ï¼‰

**Request:**
```json
{
  "image": "base64_encoded_image",
  "context": {
    "view": "overview | region-detail",
    "region": "APAC",
    "timeRange": "Last 90 days",
    "audience": "All Audiences"
  }
}
```

**Response:**
```json
{
  "status": "success",
  "analysis": "## 1ï¸âƒ£ ç¾æ³è¨ºæ–·\n...",
  "model": "models/gemini-2.0-flash",
  "timestamp": "2026-01-15T10:30:00Z"
}
```

#### GET /api/ai/settings
å–å¾— AI è¨­å®šï¼ˆéœ€ç®¡ç†å“¡æ¬Šé™ï¼‰

**Response:**
```json
{
  "status": "success",
  "settings": {
    "enabled": true,
    "model": "models/gemini-2.0-flash",
    "system_prompt": "ä½ æ˜¯ä¸€ä½ã€Œå¯¦æˆ°æ´¾è¡ŒéŠ·ç­–ç•¥é¡§å•ã€...",
    "output_format": "è«‹åš´æ ¼ä¾ç…§ä»¥ä¸‹çµæ§‹è¼¸å‡ºåˆ†æå ±å‘Š..."
  },
  "api_key_configured": true
}
```

#### PUT /api/ai/settings
æ›´æ–° AI è¨­å®šï¼ˆéœ€ç®¡ç†å“¡æ¬Šé™ï¼‰

#### POST /api/ai/settings/reset
é‡ç½®ç‚ºé è¨­å€¼ï¼ˆéœ€ç®¡ç†å“¡æ¬Šé™ï¼‰

---

## Gemini AI Prompt è¨­è¨ˆ

### é è¨­ç³»çµ±æç¤ºè©

```
ä½ æ˜¯ä¸€ä½ã€Œå¯¦æˆ°æ´¾è¡ŒéŠ·ç­–ç•¥é¡§å•ã€ï¼Œæ“…é•·å¿«é€Ÿè¨ºæ–· Email/EDM è¡ŒéŠ·æ•¸æ“šä¸¦çµ¦å‡ºå¯ç«‹å³åŸ·è¡Œçš„å»ºè­°ã€‚

ä½ çš„è§’è‰²ç‰¹è³ªï¼š
1. ç›´æ¥è¬›é‡é»ï¼Œä¸èªªå»¢è©±ã€ä¸éåº¦è§£é‡‹åŸºç¤æ¦‚å¿µ
2. æ¯å€‹å»ºè­°éƒ½é™„å¸¶ã€Œç‚ºä»€éº¼ã€çš„ç°¡çŸ­ç†ç”±ï¼ˆä¸€å¥è©±å…§ï¼‰
3. å„ªå…ˆè§£æ±ºæœ€å½±éŸ¿ ROI çš„å•é¡Œ
4. å–„ç”¨ 80/20 æ³•å‰‡â”€â”€èšç„¦å°‘æ•¸èƒ½å¸¶ä¾†æœ€å¤§æ•ˆç›Šçš„è¡Œå‹•
5. æ‰€æœ‰æ•¸å­—åˆ¤æ–·éƒ½æœ‰è¡Œæ¥­åƒè€ƒå€¼ä¾æ“š

è¡Œæ¥­åƒè€ƒå€¼ï¼ˆB2B ç§‘æŠ€/ç¶²é€šç”¢æ¥­ï¼‰ï¼š
- Open Rate æ­£å¸¸å€¼ï¼š15-25%
- Click Rate æ­£å¸¸å€¼ï¼š2-5%
- Bounce Rate è­¦æˆ’å€¼ï¼š> 2%
- Unsubscribe Rate è­¦æˆ’å€¼ï¼š> 0.5%
- Delivery Rate æ­£å¸¸å€¼ï¼š> 95%
```

### é è¨­è¼¸å‡ºæ ¼å¼

```
è«‹åš´æ ¼ä¾ç…§ä»¥ä¸‹çµæ§‹è¼¸å‡ºåˆ†æå ±å‘Šï¼š

## 1ï¸âƒ£ ç¾æ³è¨ºæ–·
æ ¹æ“šå„€è¡¨æ¿æ•¸æ“šï¼Œè­˜åˆ¥ã€Œè¡¨ç¾ç•°å¸¸ã€çš„ 3 å¤§å•é¡Œã€‚
æ¯é …æ ¼å¼ï¼š
- **å•é¡Œåç¨±**ï¼šå…·é«”æ•¸å€¼ï¼ˆæ­£å¸¸åƒè€ƒå€¼ï¼šXX%ï¼‰

### âœ… è¡¨ç¾è‰¯å¥½
- åˆ—å‡ºè¡¨ç¾å„ªæ–¼åƒè€ƒå€¼çš„æŒ‡æ¨™

### âš ï¸ éœ€è¦é—œæ³¨
- åˆ—å‡ºç•¥ä½æ–¼åƒè€ƒå€¼ä½†éç·Šæ€¥çš„æŒ‡æ¨™

### ğŸš¨ åš´é‡å•é¡Œ
- åˆ—å‡ºé¡¯è‘—ä½æ–¼åƒè€ƒå€¼éœ€ç«‹å³è™•ç†çš„æŒ‡æ¨™

---

## 2ï¸âƒ£ æ ¸å¿ƒæ´å¯Ÿèˆ‡ç†ç”±
æå‡º 3 é»æ´å¯Ÿï¼ˆä¸æ˜¯å•é¡Œçš„é‡è¿°ï¼Œè€Œæ˜¯è³‡æ–™äº¤å‰æ¯”å°å¾Œçš„ã€Œç‚ºä»€éº¼ã€ï¼‰
æ ¼å¼ï¼š
- **æ´å¯Ÿ**ï¼šç°¡çŸ­è§£é‡‹ï¼ˆ15 å­—å…§ï¼‰

---

## 3ï¸âƒ£ æœ¬é€±åŸ·è¡Œæ¸…å–®
åˆ—å‡º 5-7 é …å…·é«”è¡Œå‹•ï¼Œå¯ç›´æ¥åŸ·è¡Œã€‚ä½¿ç”¨ checkbox æ ¼å¼ï¼š
- [ ] è¡Œå‹•é …ç›® 1
- [ ] è¡Œå‹•é …ç›® 2
...

---

## 4ï¸âƒ£ è‡ªå‹•åŒ–å»ºè­°
è‹¥æ¥å…¥è¡ŒéŠ·è‡ªå‹•åŒ–å·¥å…·ï¼Œåˆ—å‡ºå„ªå…ˆåŸ·è¡Œ 2-3 é …è‡ªå‹•åŒ–ï¼š
- è‡ªå‹•åŒ–åç¨± â†’ é æœŸæ•ˆç›Šï¼ˆä¸€å¥è©±ï¼‰
```

---

## UI/UX è¨­è¨ˆ

### AI æµ®å‹•æŒ‰éˆ• (FAB)
- **ä½ç½®**ï¼šç•«é¢å³ä¸‹è§’ï¼Œè·é›¢é‚Šç·£ 1rem
- **æ¨£å¼**ï¼š
  - 56x56px åœ“å½¢
  - æ¼¸å±¤èƒŒæ™¯ï¼šç´«è‰² (#8B5CF6) åˆ°é’è‰² (#06B6D4)
  - ç™¼å…‰æ•ˆæœï¼šblur shadow
  - Hoverï¼šæ”¾å¤§ 1.05x + æ—‹è½‰ç™¼å…‰
- **æ¬Šé™**ï¼šåƒ…ç®¡ç†å“¡å¯è¦‹
- **ç‹€æ…‹**ï¼š
  - é è¨­ï¼šé¡¯ç¤º Sparkles åœ–ç¤º
  - Loadingï¼šé¡¯ç¤ºæ—‹è½‰å‹•ç•«

### Loading ç‹€æ…‹
- å…¨è¢å¹• overlay + å‹•ç•«
- æ–‡å­—æç¤ºè¼ªæ’­ï¼š
  - "AI åˆ†æä¸­..."
  - "æ­£åœ¨è­˜åˆ¥é—œéµæŒ‡æ¨™..."
  - "ç”Ÿæˆè¡ŒéŠ·æ´å¯Ÿ..."
  - "å³å°‡å®Œæˆ..."

### çµæœ Modal
- **å¯¬åº¦**ï¼šmax-w-4xl
- **Header**ï¼šæ¼¸å±¤èƒŒæ™¯ + Sparkles åœ–ç¤º + æ¨™é¡Œ
- **Context Bar**ï¼šé¡¯ç¤ºåˆ†ææ™‚çš„æª¢è¦–/æœŸé–“/å—çœ¾
- **å…§å®¹å€**ï¼š
  - å°ˆæ¥­ Markdown æ¸²æŸ“
  - è‰²å½©å€å¡Šï¼ˆä¾ emoji é¡å‹ï¼‰
  - å¯å‹¾é¸ checkbox æ¸…å–®
- **Footer**ï¼š
  - ã€Œè¤‡è£½å…¨éƒ¨ã€æŒ‰éˆ•
  - ã€Œé—œé–‰ã€æŒ‰éˆ•
  - AI åƒ…ä¾›åƒè€ƒæç¤º

---

## éŒ¯èª¤è™•ç†

| éŒ¯èª¤æƒ…å¢ƒ | è™•ç†æ–¹å¼ |
|---------|---------|
| æˆªåœ–å¤±æ•— | é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ï¼Œå»ºè­°é‡è©¦ |
| API è«‹æ±‚é€¾æ™‚ | 120 ç§’é€¾æ™‚ï¼Œé¡¯ç¤ºé‡è©¦é¸é … |
| Gemini API éŒ¯èª¤ | é¡¯ç¤ºå‹å–„éŒ¯èª¤è¨Šæ¯ |
| API Key æœªè¨­å®š | æŒ‰éˆ•ä¸é¡¯ç¤º |
| AI åŠŸèƒ½å·²åœç”¨ | æŒ‰éˆ•ä¸é¡¯ç¤º |

---

## å®‰å…¨æ€§è€ƒé‡

1. **æ¬Šé™æ§åˆ¶**ï¼šåƒ…ç®¡ç†å“¡å¯å­˜å– AI åŠŸèƒ½
2. **API Key ä¿è­·**ï¼šGemini API Key åªå­˜åœ¨å¾Œç«¯ç’°å¢ƒè®Šæ•¸
3. **åœ–ç‰‡è™•ç†**ï¼šæˆªåœ–ä¸å„²å­˜ï¼Œåˆ†æå®Œå³ä¸Ÿæ£„
4. **è¨­å®šæ¬Šé™**ï¼šåƒ…ç®¡ç†å“¡å¯ä¿®æ”¹ AI è¨­å®š

---

## ç’°å¢ƒè®Šæ•¸

```env
# Backend
GEMINI_API_KEY=your_gemini_api_key_here    # å¿…å¡«
GEMINI_MODEL=models/gemini-2.0-flash        # é¸å¡«ï¼Œé è¨­å€¼
```

---

## è³‡æ–™åº«çµæ§‹

### settings è¡¨

```sql
CREATE TABLE IF NOT EXISTS settings (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
```

### AI è¨­å®šéµå€¼

| Key | Description |
|-----|-------------|
| ai_enabled | AI åŠŸèƒ½é–‹é—œ (true/false) |
| ai_model | Gemini æ¨¡å‹åç¨± |
| ai_system_prompt | ç³»çµ±æç¤ºè© |
| ai_output_format | è¼¸å‡ºæ ¼å¼å®šç¾© |

---

## å¯¦ä½œç‹€æ…‹

### Phase 1 - MVP âœ…
- [x] å¾Œç«¯ API endpoints
- [x] Gemini API æ•´åˆ
- [x] å‰ç«¯æµ®å‹•æŒ‰éˆ•
- [x] æˆªåœ–åŠŸèƒ½
- [x] çµæœé¡¯ç¤º Modal
- [x] å°ˆæ¥­ Markdown æ¸²æŸ“

### Phase 2 - Settings âœ…
- [x] AI åŠŸèƒ½é–‹é—œ
- [x] æ¨¡å‹é¸æ“‡
- [x] å¯è‡ªè¨‚æç¤ºè©
- [x] å¯è‡ªè¨‚è¼¸å‡ºæ ¼å¼
- [x] é‡ç½®ç‚ºé è¨­å€¼

### Phase 3 - Future
- [ ] åˆ†ææ­·å²è¨˜éŒ„
- [ ] åŒ¯å‡ºåˆ†æå ±å‘Šï¼ˆPDFï¼‰
- [ ] æ’ç¨‹è‡ªå‹•åˆ†æ
- [ ] å¤šèªè¨€æ”¯æ´

---

## ç›¸ä¾å¥—ä»¶

### Backend
```
google-generativeai>=0.3.0
```

### Frontend
- ç„¡æ–°å¢ï¼ˆä½¿ç”¨ç¾æœ‰ html2canvasï¼‰

---

## åƒè€ƒè³‡æº

- [Gemini API Documentation](https://ai.google.dev/docs)
- [html2canvas Documentation](https://html2canvas.hertzen.com/)
